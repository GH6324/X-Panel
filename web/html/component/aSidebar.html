{{define "component/sidebar/content"}}
<template>
    <div class="ant-sidebar">
        <a-layout-sider :theme="themeSwitcher.currentTheme" collapsible :collapsed="collapsed"
            @collapse="(isCollapsed, type) => collapseHandle(isCollapsed, type)" breakpoint="md">
            
            <a-theme-switch></a-theme-switch>
            
            <a-menu :theme="themeSwitcher.currentTheme" mode="inline" :selected-keys="activeTab"
                @click="({key}) => openLink(key)">
                <a-menu-item v-for="tab in tabs" :key="tab.key">
                    <a-icon :type="tab.icon"></a-icon>
                    <span v-text="tab.title"></span>
                </a-menu-item>
            </a-menu>

            <div class="sidebar-copyright-wrapper" v-show="!collapsed">
                <div class="copyright-content">
                    <div class="brand-row">
                        <a-icon type="safety-certificate" theme="filled" class="brand-icon"></a-icon>
                        <span class="brand-name">X-Panel</span>
                    </div>
                    <div class="year-row">
                        <span>Copyright <a-icon type="copyright"></a-icon> 2022-2025</span>
                    </div>
                </div>
            </div>
            </a-layout-sider>

        <a-drawer placement="left" :closable="false" @close="closeDrawer" :visible="visible"
            :wrap-class-name="themeSwitcher.currentTheme" :wrap-style="{ padding: 0 }" :style="{ height: '100%' }">
            <div class="drawer-handle" @click="toggleDrawer" slot="handle">
                <a-icon :type="visible ? 'close' : 'menu-fold'"></a-icon>
            </div>
            <a-theme-switch></a-theme-switch>
            <a-menu :theme="themeSwitcher.currentTheme" mode="inline" :selected-keys="activeTab"
                @click="({key}) => openLink(key)">
                <a-menu-item v-for="tab in tabs" :key="tab.key">
                    <a-icon :type="tab.icon"></a-icon>
                    <span v-text="tab.title"></span>
                </a-menu-item>
            </a-menu>
        </a-drawer>
    </div>
</template>
{{end}}

{{define "component/aSidebar"}}
<style>
    /* 1. 基础布局设置 */
    .ant-sidebar > .ant-layout-sider {
        height: 100%;
        position: relative;
        display: flex;
        flex-direction: column;
    }
    
    /* 确保菜单占据剩余空间，把版权顶到底部 */
    .ant-sidebar .ant-menu {
        flex-grow: 1;
        overflow-y: auto;
        padding-bottom: 80px; /* 防止菜单最后一行被版权挡住 */
    }

    /* 2. 版权区域容器 */
    .sidebar-copyright-wrapper {
        position: absolute;
        bottom: 0;
        width: 100%;
        padding: 15px 0 20px 0; /* 上下内边距 */
        text-align: center;
        /* 添加顶部磨砂半透明分割线，看起来更有质感 */
        border-top: 1px solid rgba(128, 128, 128, 0.15);
        background: inherit; /* 继承背景色 */
        z-index: 10;
        pointer-events: none; /* 仅展示，不阻挡交互 */
    }

    /* 3. 品牌行样式 (Pro标识) */
    .brand-row {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 15px;
        font-weight: 600; /* 加粗 */
        margin-bottom: 4px;
        opacity: 0.9;
        letter-spacing: 0.5px;
    }

    /* 品牌图标样式 */
    .brand-icon {
        margin-right: 6px;
        font-size: 16px;
        opacity: 0.8; /* 稍微淡一点 */
    }

    /* 4. 年份版权行样式 */
    .year-row {
        font-size: 11px; /* 小号字体 */
        opacity: 0.5;    /* 降低透明度 */
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* 版权符号微调 */
    .year-row .anticon-copyright {
        font-size: 10px;
        margin: 0 3px; /* 符号左右留空隙 */
        position: relative;
        top: 0px;
    }
</style>

<script>
    const SIDEBAR_COLLAPSED_KEY = "isSidebarCollapsed"

    Vue.component('a-sidebar', {
        data() {
            return {
                tabs: [
                    {
                        key: '{{ .base_path }}panel/',
                        icon: 'dashboard',
                        title: '{{ i18n "menu.dashboard"}}'
                    },
                    {
                        key: '{{ .base_path }}panel/inbounds',
                        icon: 'user',
                        title: '{{ i18n "menu.inbounds"}}'
                    },
                    {
                        key: '{{ .base_path }}panel/settings',
                        icon: 'setting',
                        title: '{{ i18n "menu.settings"}}'
                    },
                    {
                        key: '{{ .base_path }}panel/xray',
                        icon: 'tool',
                        title: '{{ i18n "menu.xray"}}'
                    },
                    {
                        key: '{{ .base_path }}panel/servers',
                        icon: 'cloud-server', 
                        title: '{{ i18n "pages.controlledmanagement.title"}}'
                    },
                    {
                        key: '{{ .base_path }}panel/navigation',
                        icon: 'link',
                        title: '{{ i18n "menu.navigation"}}'
                    },
                    {
                        key: '{{ .base_path }}logout/',
                        icon: 'logout',
                        title: '{{ i18n "menu.logout"}}'
                    },
                ],
                activeTab: [
                    '{{ .request_uri }}'
                ],
                visible: false,
                collapsed: JSON.parse(localStorage.getItem(SIDEBAR_COLLAPSED_KEY)),
            }
        },
        methods: {
            openLink(key) {
                return key.startsWith('http') ? 
                    window.open(key) : 
                    location.href = key
            },
            closeDrawer() {
                this.visible = false;
            },
            toggleDrawer() {
                this.visible = !this.visible;
            },
            collapseHandle(collapsed, type) {
                if (type === "clickTrigger") {
                    localStorage.setItem(SIDEBAR_COLLAPSED_KEY, collapsed);

                    this.collapsed = JSON.parse(localStorage.getItem(SIDEBAR_COLLAPSED_KEY));
                }
            }
        },
        template: `{{template "component/sidebar/content"}}`,
    });
</script>
{{end}}
